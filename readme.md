[![codecov](https://codecov.io/gh/steftroubadour/yi-king/branch/main/graph/badge.svg?token=m5EOdrKkz8)](https://codecov.io/gh/steftroubadour/yi-king)

# Yi Jing 易经

A blockchain implementation of I Ching divination.

[https://en.wikipedia.org/wiki/I_Ching](https://en.wikipedia.org/wiki/I_Ching)

![Yi Jing](img/yijing.png)

# Use case
Use Blockchain to store information for eternity.
This information must be easily readable.
Add possibility to encrypt information would be great.
Add possibility to upgrade images and retrieve different version.
Have a low gas fee at mint.

# Unresolved problems
Encryption can't be realised on-chain.
For example, using elliptic curve consuming to much gas in EVM.
Solution can be find in other non-EVM blockchains or layers 2.

# Resolved problems
## Functionalities
### NFT ERC-721
The draw result of I Ching divination is store as an NFT

#### metadata
* image: animated SVG store on-the-same-chain (not on IPFS or on other chain)
* message: json with name & question. Can be stored encrypted.
* is message encrypted: true / false

if encrypted message
* to remember how to decrypt the message
#### image version
* add version management for metadata / image, tokenURI(tokenID, version)
#### random function is external
Possibility to change `getNumbers()` in a new contract.
Note : random could be render locally.
#### Support affiliation
An affiliate must earn revenues publishing
#### Support non custodial wallet
Add the possibility to new Blockchain users, to create an account, pay with card & have a non-custodial wallet
see [web3auth.io](https://web3auth.io)

### Affiliate integration
make an easy IFrame integration for any website page.

## Tech specifications
### Smart contracts
Development use Solidity language and Foundry
#### Random contract
Random will be used on-chain
#### Image contract
image is an animated svg and can have multiple versions
#### NFT contract
draw will be save on-chain in an NFT
* erc721
* metadata and image are **on-the-same-chain**
* image is read from previous contract
* must have a specific tokenURI to retrieve specific image version
#### Affiliation contract
To share benefits from mint with affiliated
* add/remove affiliate member
* member has address and percent retribution in basis point (bp)
## Contracts addresses
### Ethereum Testnet Sepolia (11155111)
| Contract Name | Address                                    |
|---------------|--------------------------------------------|
| NFT           | 0x1f809D18347dCa1d52A3a0a29a72ec6966f87456 |
| Metadata      | 0x57D1988Ae830f47b8a590D62fC22F34C378616Ad |
| Image         | 0x9283f9Fe8F2C41A852eA33a5931CB1544DB30aef |
| Affiliation   | 0x52B48420f00B0bCD585C5169dF7A6c1aBd2046E1 |
| Random        | 0x5045B684544065099538f65Fa7aaf62A95a6e198 |
### Polygon Testnet Mumbai (80001)
| Contract Name | Address                                    |
|---------------|--------------------------------------------|
| NFT           | 0x |
| Metadata      | 0x |
| Image         | 0x |
| Affiliation   | 0x |
| Random        | 0x |

# FLOW
## Random draw, first hexagram
By writing your name or pseudonym and a well-chosen question, we can consider the intention to be fixed. To have the
first hexagram call for Yi Jing divination, we use randomness, assuming that the random hexagram result is equal to the
yarrow-stalk method or coins method results. The randomness is on-chain, but it could be generated by the server. The
usage of on-chain VRF like Chainlink VRF is not used because it is not necessary.
### first hexagram
![hexagram](img/hexagram.png)
### from hexagram (the present, how it is now)
![from](img/from.png)
### to hexagram (how that could be)
![to](img/to.png)

## Mint the NFT
To save draw, pseudo & question for eternity, we mint an NFT
### pseudo & question
There is no on-chain solution to encrypt data on-chain. 
By now, solution is to encrypt the message by yourself.

![nft_image](img/nft_image.png)